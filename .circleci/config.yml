version: 2.1

env: &env
  docker:
    - image: circleci/openjdk:8-jdk
  working_directory: ~/repo

  environment:    
    JVM_OPTS: -Xmx3584M -Xms1024M -Xss16M
    TERM: dumb

jobs:
  build_all:
    parameters:
      scala_version:
        description: "Scala version"
        default: 2.13.3
        type: string
    <<: *env
    steps:
      - checkout
      - run: cat /dev/null | sbt ++<< parameters.scala_version >> clean test publishLocalAll  
      - run:
          command: |
            cd examples
            cat /dev/null | sbt ++<< parameters.scala_version >> compile

workflows:
  build:
    jobs:
      - build_all:
          name: 2.12.12
          scala_version: 2.12.12
      - build_all:
          name: 2.13.3
          scala_version: 2.13.3

